<!DOCTYPE html>
<html>
<head>
    <title>WebXR AR Border Frame</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <button id="startAR" style="position: fixed; top: 20px; right: 20px; z-index: 100;">Start AR</button>
    <script>
        let camera, scene, renderer;
        let frame;

        init();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);
            
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true // Important for AR to show camera feed
            });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Create frame geometry
            const frameGeometry = new THREE.PlaneGeometry(1, 1.5); // Adjusted size for better AR viewing
            
            // Load the border texture
            const textureLoader = new THREE.TextureLoader();
            const borderTexture = textureLoader.load('https://github.com/laithi/arjstest/blob/50d5e954ca5bd210460589fceba8a68fe17f751a/pngtree-abstract-fluid-instagram-story-border-png-image_6243695.jpg');
            
            const frameMaterial = new THREE.MeshBasicMaterial({
                map: borderTexture,
                transparent: true,
                opacity: 0.8,
                side: THREE.DoubleSide
            });

            frame = new THREE.Mesh(frameGeometry, frameMaterial);
            frame.position.z = -1.5; // Position the frame in front of the camera
            scene.add(frame);

            // Set up AR button and session
            const arButton = document.getElementById('startAR');
            arButton.addEventListener('click', onStartAR);

            // Handle window resizing
            window.addEventListener('resize', onWindowResize, false);
        }

        async function onStartAR() {
            // Check if AR is supported
            if (!navigator.xr) {
                alert("WebXR not available");
                return;
            }

            try {
                // Request an AR session
                const session = await navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['hit-test'],
                    optionalFeatures: ['dom-overlay'],
                    domOverlay: { root: document.body }
                });

                // Set up session
                await renderer.xr.setSession(session);
                session.addEventListener('end', onSessionEnd);

                // Start the AR experience
                renderer.setAnimationLoop(render);
            } catch (err) {
                console.error('Failed to start AR session:', err);
                alert("Error starting AR session: " + err.message);
            }
        }

        function onSessionEnd() {
            renderer.setAnimationLoop(null);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function render(timestamp, frame) {
            if (frame) {
                const pose = frame.getViewerPose(renderer.xr.getReferenceSpace('local'));
                if (pose) {
                    // Update frame position to follow camera
                    const viewMatrix = pose.views[0].transform.matrix;
                    const position = new THREE.Vector3();
                    position.setFromMatrixPosition(viewMatrix);
                    
                    // Position frame in front of the camera
                    frame.position.copy(position);
                    frame.position.z -= 1.5;
                    
                    // Make frame face the camera
                    frame.quaternion.copy(camera.quaternion);
                }
            }
            
            renderer.render(scene, camera);
        }

        // Check if AR is available
        if (navigator.xr) {
            navigator.xr.isSessionSupported('immersive-ar')
                .then((supported) => {
                    if (!supported) {
                        document.getElementById('startAR').disabled = true;
                        document.getElementById('startAR').textContent = 'AR NOT SUPPORTED';
                    }
                });
        } else {
            document.getElementById('startAR').disabled = true;
            document.getElementById('startAR').textContent = 'WebXR NOT AVAILABLE';
        }
    </script>
</body>
</html>
