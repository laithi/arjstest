<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تلوين منطقة العينين باللون الأحمر</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #jeelizFaceFilterCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>
  <!-- تضمين مكتبة Jeeliz FaceFilter -->
  <script src="https://cdn.jsdelivr.net/npm/jeelizfacefilter@1/dist/jeelizFaceFilter.js"></script>
  <!-- تضمين Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
</head>
<body>
  <canvas id="jeelizFaceFilterCanvas"></canvas>

  <script>
    // المتغيرات العامة
    let threeCamera;

    // وظيفة البدء
    function main() {
      JEELIZFACEFILTER.init({
        canvasId: 'jeelizFaceFilterCanvas',
        NNCpath: 'https://cdn.jsdelivr.net/npm/jeelizfacefilter@1/dist/', // مسار ملفات الشبكة العصبية
        callbackReady: function(errCode, spec) {
          if (errCode) {
            console.log('خطأ في التهيئة: ', errCode);
            return;
          }
          console.log('Jeeliz FaceFilter جاهز');
          initThreeScene(spec);
        },
        callbackTrack: function(detectState) {
          if (threeCamera) {
            JEELIZFACEFILTER.render_threeScene(detectState, threeCamera);
          }
        }
      });
    }

    // تهيئة مشهد Three.js
    function initThreeScene(spec) {
      const threeScene = new THREE.Scene();

      // إعداد الكاميرا
      threeCamera = new THREE.PerspectiveCamera(40, spec.canvasElement.width / spec.canvasElement.height, 0.1, 100);
      threeCamera.position.z = 5;

      // إضافة إضاءة
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
      threeScene.add(ambientLight);

      // إنشاء مادة حمراء شفافة
      const redMaterial = new THREE.MeshBasicMaterial({
        color: 0xff0000,
        transparent: true,
        opacity: 0.5
      });

      // إنشاء هندسة القناع لمنطقة العينين
      const eyeMaskGeometry = new THREE.PlaneGeometry(2, 0.5);
      const eyeMaskMesh = new THREE.Mesh(eyeMaskGeometry, redMaterial);
      eyeMaskMesh.position.set(0, 0.2, 0);
      eyeMaskMesh.frustumCulled = false;

      // إضافة القناع إلى المشهد
      threeScene.add(eyeMaskMesh);

      // تهيئة الكائن ثلاثي الأبعاد للرأس الافتراضي
      JEELIZFACEFILTER.set_threexScene(threeScene);

      // تحديث موقع القناع بناءً على تتبع الوجه
      JEELIZFACEFILTER.on_render(function(detectState){
        if (detectState.isDetected) {
          const headScale = detectState.scale;
          const headX = detectState.x;
          const headY = detectState.y;

          // تحديث المقياس والموقع
          eyeMaskMesh.position.set(headX, headY + 0.05, 0);
          eyeMaskMesh.scale.set(headScale * 1.5, headScale * 0.5, 1);
        }
      });
    }

    // بدء التطبيق
    main();
  </script>
</body>
</html>
