<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebAR Hole in Floor Effect</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-assets>
            <img id="hole-texture" src="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/hardwood2_diffuse.jpg" />
        </a-assets>

        <a-marker preset="hiro">
            <a-entity id="hole-container">
                <!-- Hole -->
                <a-cylinder position="0 -0.5 0" radius="0.5" height="1" open-ended="true" side="double" material="src: #hole-texture; repeat: 1 1; roughness: 0.8; metalness: 0.2"></a-cylinder>
                
                <!-- Mask (box geometry) -->
                <a-box position="0 -0.5 0" width="1.1" depth="1.1" height="0.1" material="color: #808080; opacity: 0.97"></a-box>
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        AFRAME.registerComponent('modify-materials', {
            init: function () {
                // Wait for the scene to load
                this.el.sceneEl.addEventListener('loaded', () => {
                    // Get the hole container
                    const holeContainer = document.querySelector('#hole-container');

                    // Modify materials for better blending
                    holeContainer.object3D.traverse((node) => {
                        if (node.isMesh) {
                            node.material.depthWrite = false;
                            node.renderOrder = 1;
                        }
                    });

                    // Add subtle animation
                    this.el.setAttribute('animation', {
                        property: 'rotation',
                        dur: 10000,
                        easing: 'linear',
                        loop: true,
                        to: '0 360 0'
                    });
                });
            }
        });

        // Add the component to the scene
        document.querySelector('a-scene').setAttribute('modify-materials', '');
    </script>
</body>
</html>
