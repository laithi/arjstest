<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>تأثير WebAR مع إيماءات المستخدم</title>
  <!-- تضمين A-Frame -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <!-- تضمين AR.js -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <!-- تضمين Hammer.js -->
  <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #instructions {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      text-align: center;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div id="instructions">
    استخدم إيماءات اللمس لتكبير/تصغير وتدوير الكائن.
  </div>
  <a-scene embedded arjs>
    <!-- كائن ثلاثي الأبعاد -->
    <a-box position="0 0.5 0" color="red" id="my-box"></a-box>
    <!-- كاميرا الواقع المعزز -->
    <a-camera-static></a-camera-static>
  </a-scene>

  <script>
    // الحصول على الكائن الثلاثي الأبعاد
    const box = document.getElementById('my-box');

    // إنشاء مدير Hammer.js للمشهد
    const sceneEl = document.querySelector('a-scene').sceneEl.canvas;

    // التأكد من جاهزية المشهد قبل التفاعل
    if (sceneEl) {
      initializeGestures(sceneEl);
    } else {
      document.querySelector('a-scene').addEventListener('render-target-loaded', function() {
        initializeGestures(this.sceneEl.canvas);
      });
    }

    function initializeGestures(element) {
      const mc = new Hammer.Manager(element);

      // تعريف التعرفات
      const pinch = new Hammer.Pinch();
      const rotate = new Hammer.Rotate();
      const pan = new Hammer.Pan();

      // استخدامهم بشكل منفصل
      pinch.recognizeWith(rotate);

      mc.add([pinch, rotate, pan]);

      let initialScale = 1;
      let currentScale = 1;
      let initialRotation = 0;
      let currentRotation = 0;
      let initialPosition = { x: 0, y: 0 };
      let currentPosition = { x: 0, y: 0 };

      mc.on('pinchstart', function(ev) {
        initialScale = currentScale;
      });

      mc.on('pinchmove', function(ev) {
        currentScale = initialScale * ev.scale;
        box.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
      });

      mc.on('rotatestart', function(ev) {
        initialRotation = currentRotation;
      });

      mc.on('rotatemove', function(ev) {
        currentRotation = initialRotation + ev.rotation;
        box.setAttribute('rotation', `0 ${currentRotation} 0`);
      });

      mc.on('panstart', function(ev) {
        initialPosition = { x: currentPosition.x, y: currentPosition.y };
      });

      mc.on('panmove', function(ev) {
        currentPosition.x = initialPosition.x + ev.deltaX / 100;
        currentPosition.y = initialPosition.y - ev.deltaY / 100;
        box.setAttribute('position', `${currentPosition.x} 0.5 ${currentPosition.y}`);
      });
    }
  </script>
</body>
</html>
