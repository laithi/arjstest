<!DOCTYPE html>
<html>
  <head>
    <title>WebAR Bouncing Cube</title>
    <!-- Include A-Frame library -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- Include AR.js for AR capabilities -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <!-- A-Frame Scene with AR.js attributes -->
    <a-scene
      embedded
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; debugUIEnabled: false;"
      cursor="rayOrigin: mouse"
    >
      <!-- Bouncing Cube -->
      <a-box
        id="cube"
        position="0 1 -5"
        rotation="0 45 0"
        color="#4CC3D9"
        animation="property: position; dir: alternate; dur: 1000; loop: true; to: 0 2 -5"
        gesture-handler
      ></a-box>

      <!-- Camera -->
      <a-camera position="0 1.6 0" look-controls="enabled: false"></a-camera>
    </a-scene>

    <!-- Gesture Handler Component -->
    <script>
      AFRAME.registerComponent('gesture-handler', {
        init: function () {
          const cube = this.el;
          let isDragging = false;
          let previousPosition = null;

          // Start dragging on mouse down or touch start
          cube.addEventListener('mousedown', startDrag);
          cube.addEventListener('touchstart', startDrag);

          // Dragging logic
          function startDrag(event) {
            isDragging = true;
            previousPosition = getPosition(event);
          }

          // Update cube position on mouse move or touch move
          window.addEventListener('mousemove', drag);
          window.addEventListener('touchmove', drag);

          function drag(event) {
            if (!isDragging) return;

            const currentPosition = getPosition(event);
            const deltaX = currentPosition.x - previousPosition.x;
            const deltaY = currentPosition.y - previousPosition.y;

            const newPosition = cube.object3D.position.clone();
            newPosition.x += deltaX * 0.01;
            newPosition.y -= deltaY * 0.01; // Invert Y axis for intuitive control

            cube.setAttribute('position', newPosition);

            previousPosition = currentPosition;
          }

          // End dragging on mouse up or touch end
          window.addEventListener('mouseup', endDrag);
          window.addEventListener('touchend', endDrag);

          function endDrag() {
            isDragging = false;
          }

          // Helper function to get cursor or touch position
          function getPosition(event) {
            if (event.touches && event.touches[0]) {
              return { x: event.touches[0].clientX, y: event.touches[0].clientY };
            } else {
              return { x: event.clientX, y: event.clientY };
            }
          }
        }
      });
    </script>
  </body>
</html>
