<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markerless WebAR 3D Model</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/jsm/libs/stats.module.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
<script>
    let scene, camera, renderer, model;
    let initCameraZ = 2; // Initial distance of the model
    let isUserInteracting = false, scale = 1;

    function init() {
        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = initCameraZ;

        renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
        light.position.set(0, 20, 0);
        scene.add(light);

        // Load 3D Model
        const loader = new THREE.GLTFLoader();
        loader.load('https://github.com/laithi/arjstest/blob/main/future%20museum.gltf', function(gltf) {
            model = gltf.scene;
            model.scale.set(1, 1, 1);
            scene.add(model);
        });

        // Add event listeners for touch gestures
        document.addEventListener('touchstart', onDocumentTouchStart, false);
        document.addEventListener('touchmove', onDocumentTouchMove, false);
        document.addEventListener('touchend', onDocumentTouchEnd, false);

        animate();
    }

    function onDocumentTouchStart(event) {
        isUserInteracting = true;
    }

    function onDocumentTouchMove(event) {
        if (isUserInteracting && model) {
            // Adjust model scale for zoom gesture (using pinch)
            if (event.touches.length == 2) {
                const dist = Math.hypot(
                    event.touches[0].pageX - event.touches[1].pageX,
                    event.touches[0].pageY - event.touches[1].pageY
                );
                scale = dist / 300; // Adjust scale factor based on touch distance
                model.scale.set(scale, scale, scale);
            }
            // Rotate model with single touch drag
            else if (event.touches.length == 1) {
                model.rotation.y += event.touches[0].movementX * 0.005;
                model.rotation.x += event.touches[0].movementY * 0.005;
            }
        }
    }

    function onDocumentTouchEnd() {
        isUserInteracting = false;
    }

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    init();
</script>
</body>
</html>
