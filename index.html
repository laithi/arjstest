<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تلوين منطقة العينين باللون الأحمر</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #jeelizFaceFilterCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
    }
  </style>
  <!-- تضمين مكتبة Jeeliz FaceFilter -->
  <script src="https://cdn.jsdelivr.net/npm/jeelizfacefilter@1.1.2/dist/jeelizFaceFilter.min.js"></script>
  <!-- تضمين Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
</head>
<body>
  <canvas id="jeelizFaceFilterCanvas"></canvas>

  <script>
    // المتغيرات العامة
    let threeCamera, threeScene, renderer, faceMesh;

    // وظيفة البدء
    function main() {
      JEELIZFACEFILTER.init({
        canvasId: 'jeelizFaceFilterCanvas',
        NNCpath: 'https://cdn.jsdelivr.net/npm/jeelizfacefilter@1.1.2/dist/', // مسار ملفات الشبكة العصبية
        callbackReady: function(errCode, spec) {
          if (errCode) {
            console.log('خطأ في التهيئة: ', errCode);
            return;
          }
          console.log('Jeeliz FaceFilter جاهز');
          initThreeScene(spec);
        },
        callbackTrack: function(detectState) {
          if (threeCamera) {
            JEELIZFACEFILTER.render_three(detectState, threeCamera);
          }
        }
      });
    }

    // تهيئة مشهد Three.js
    function initThreeScene(spec) {
      threeScene = new THREE.Scene();

      // إعداد الكاميرا
      threeCamera = new THREE.PerspectiveCamera(1, spec.canvasElement.width / spec.canvasElement.height, 0.1, 100);
      threeCamera.position.z = 0;

      // إعداد الإضاءة
      const ambientLight = new THREE.AmbientLight(0xffffff, 1);
      threeScene.add(ambientLight);

      // إنشاء مادة حمراء شفافة
      const redMaterial = new THREE.MeshBasicMaterial({
        color: 0xff0000,
        transparent: true,
        opacity: 0.5,
        side: THREE.DoubleSide
      });

      // إنشاء هندسة القناع لمنطقة العينين باستخدام PlaneGeometry
      const eyeMaskGeometry = new THREE.PlaneGeometry(0.6, 0.2);
      faceMesh = new THREE.Mesh(eyeMaskGeometry, redMaterial);
      faceMesh.position.set(0, 0.05, 0.5); // تم تعديل الموضع
      faceMesh.rotation.x = Math.PI; // تدوير القناع لمواجهة الكاميرا
      threeScene.add(faceMesh);

      // إعداد الكائن ثلاثي الأبعاد للرأس الافتراضي
      JEELIZFACEFILTER.set_threeScene(threeScene);
    }

    // بدء التطبيق
    main();
  </script>
</body>
</html>
