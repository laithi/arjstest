<!DOCTYPE html>
<html>
<head>
    <title>Basic AR Camera Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
    <style>
        #status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            z-index: 1000;
        }
        
        #arButton {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 5px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="status">Initializing...</div>
    <button id="arButton">Start AR</button>

    <a-scene 
        webxr="optionalFeatures: dom-overlay; 
               overlayElement: #overlay;
               requiredFeatures: hit-test;"
        vr-mode-ui="enabled: false">
        
        <!-- Camera -->
        <a-camera></a-camera>
        
        <!-- Add a simple cube as a visual reference -->
        <a-box position="0 1.6 -3" color="red"></a-box>
    </a-scene>

    <script>
        window.onload = async function() {
            const status = document.getElementById('status');
            const arButton = document.getElementById('arButton');
            const scene = document.querySelector('a-scene');

            // Check for AR support
            if (!navigator.xr) {
                status.textContent = 'WebXR not available';
                return;
            }

            try {
                const supported = await navigator.xr.isSessionSupported('immersive-ar');
                if (!supported) {
                    status.textContent = 'AR not supported on this device';
                    return;
                }

                status.textContent = 'AR supported! Click button to start.';
                arButton.style.display = 'block';

                // Handle AR session start
                arButton.addEventListener('click', async () => {
                    try {
                        // Request camera permissions explicitly
                        await navigator.mediaDevices.getUserMedia({ 
                            video: { facingMode: 'environment' }, 
                            audio: false 
                        });

                        // Enter AR mode
                        scene.enterAR();
                        status.textContent = 'AR active';
                        arButton.style.display = 'none';
                    } catch (err) {
                        status.textContent = `Error: ${err.message}`;
                        console.error('AR start error:', err);
                    }
                });

            } catch (err) {
                status.textContent = `Error checking AR support: ${err.message}`;
                console.error('Setup error:', err);
            }
        };
    </script>
</body>
</html>
